{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import {\n  dependencySatisfies,\n  macroCondition,\n  importSync,\n} from '@embroider/macros';\nimport type {\n  NormalizeCalendarValue,\n  NormalizeMultipleActionValue,\n  NormalizeRangeActionValue,\n  PowerCalendarDay,\n} from 'ember-power-calendar/utils';\nimport type * as momentNs from 'moment';\nimport type { DurationInputArg2, unitOfTime } from 'moment';\n\nconst moment: typeof momentNs = (() => {\n  if (macroCondition(dependencySatisfies('moment-timezone', '*'))) {\n    return (importSync('moment-timezone') as { default: typeof momentNs })\n      .default;\n  } else if (macroCondition(dependencySatisfies('moment', '*'))) {\n    return (importSync('moment') as { default: typeof momentNs }).default;\n  } else {\n    throw new Error(\n      `ember-power-calendar-moment was unable to detect either moment-timezone or moment. Please add one of those to your app.`,\n    );\n  }\n})();\n\ntype TInclusivity = '()' | '[)' | '(]' | '[]';\n\nexport default {\n  add,\n  formatDate,\n  startOf,\n  endOf,\n  weekday,\n  isoWeekday,\n  getWeekdaysShort,\n  getWeekdaysMin,\n  getWeekdays,\n  isAfter,\n  isBefore,\n  isSame,\n  isBetween,\n  diff,\n  normalizeDate,\n  normalizeRangeActionValue,\n  normalizeMultipleActionValue,\n  normalizeCalendarDay,\n  withLocale,\n  normalizeCalendarValue,\n  normalizeDuration,\n  getDefaultLocale,\n  localeStartOfWeek,\n  startOfWeek,\n  endOfWeek,\n};\n\nexport function add(date: Date, quantity: number, unit: string): Date {\n  return moment(date)\n    .add(quantity, unit as DurationInputArg2)\n    .toDate();\n}\n\nexport function formatDate(\n  date: Date,\n  format: string,\n  locale: string | null = null,\n): string {\n  if (locale) {\n    return withLocale(locale, () => moment(date).format(format)) as string;\n  } else {\n    return moment(date).format(format);\n  }\n}\n\nexport function startOf(date: Date, unit: string): Date {\n  return moment(date)\n    .startOf(unit as unitOfTime.StartOf)\n    .toDate();\n}\n\nexport function endOf(date: Date, unit: string): Date {\n  return moment(date)\n    .endOf(unit as unitOfTime.StartOf)\n    .toDate();\n}\n\nexport function weekday(date: Date): number {\n  return moment(date).weekday();\n}\n\nexport function isoWeekday(date: Date): number {\n  return moment(date).isoWeekday();\n}\n\nexport function getWeekdaysShort(): string[] {\n  return moment.weekdaysShort();\n}\n\nexport function getWeekdaysMin(): string[] {\n  return moment.weekdaysMin();\n}\n\nexport function getWeekdays(): string[] {\n  return moment.weekdays();\n}\n\nexport function isAfter(date1: Date, date2: Date): boolean {\n  return moment(date1).isAfter(date2);\n}\n\nexport function isBefore(date1: Date, date2: Date): boolean {\n  return moment(date1).isBefore(date2);\n}\n\nexport function isSame(date1: Date, date2: Date, unit: string): boolean {\n  return moment(date1).isSame(date2, unit as unitOfTime.StartOf);\n}\n\nexport function isBetween(\n  date: Date,\n  start: Date,\n  end: Date,\n  unit?: string,\n  inclusivity?: string,\n): boolean {\n  return moment(date).isBetween(\n    start,\n    end,\n    unit as unitOfTime.StartOf,\n    inclusivity as TInclusivity,\n  );\n}\n\nexport function diff(date1: Date, date2: Date): number {\n  return moment(date1).diff(date2);\n}\n\nexport function normalizeDate(dateOrMoment?: unknown): Date | undefined {\n  if (dateOrMoment instanceof Date) {\n    return dateOrMoment;\n  } else if (moment.isMoment(dateOrMoment)) {\n    return dateOrMoment.toDate();\n  }\n}\n\nexport function normalizeRangeActionValue(val: {\n  date: {\n    start?: Date | null;\n    end?: Date | null;\n  };\n}): NormalizeRangeActionValue {\n  return {\n    date: val.date,\n    moment: {\n      start: val.date.start ? moment(val.date.start) : val.date.start,\n      end: val.date.end ? moment(val.date.end) : val.date.end,\n    },\n  };\n}\n\nexport function normalizeMultipleActionValue(val: {\n  date: Date[];\n}): NormalizeMultipleActionValue {\n  return {\n    date: val.date,\n    moment: val.date ? val.date.map((e) => moment(e)) : val.date,\n  };\n}\n\nexport function normalizeCalendarDay(day: PowerCalendarDay): PowerCalendarDay {\n  day.moment = moment(day.date);\n  day.number = moment(day.date).date();\n  return day;\n}\n\nexport function withLocale(locale: string, fn: () => unknown): unknown {\n  let returnValue;\n  if (locale) {\n    const previousLocale = moment.locale();\n    moment.locale(locale);\n    returnValue = fn();\n    moment.locale(previousLocale);\n  } else {\n    returnValue = fn();\n  }\n  return returnValue;\n}\n\nexport function normalizeCalendarValue(value: {\n  date: Date;\n}): NormalizeCalendarValue {\n  if (value) {\n    return {\n      date: value.date,\n      moment: value.date ? moment(value.date) : undefined,\n    };\n  }\n  return { date: undefined, moment: undefined };\n}\n\nexport function normalizeDuration(value: unknown): number | null | undefined {\n  if (value === null) {\n    return null;\n  }\n  if (moment.isDuration(value)) {\n    return value.asMilliseconds();\n  }\n  if (typeof value === 'number') {\n    return value;\n  }\n  if (typeof value === 'string') {\n    // let [, quantity, units] = value.match(/(\\d+)(.*)/);\n    const matches = value.match(/(\\d+)(.*)/) ?? [];\n    const quantity = matches[1] ?? '';\n    const units = (matches[2]?.trim() || 'days') as unitOfTime.Base;\n    return moment.duration(parseInt(quantity, 10), units).asMilliseconds();\n  }\n}\n\nexport function getDefaultLocale(): string {\n  return moment.locale();\n}\n\nexport function localeStartOfWeek(locale: string): number {\n  const now = new Date();\n  const day = withLocale(locale, () =>\n    formatDate(startOf(now, 'week'), 'dddd'),\n  ) as string;\n  const idx = (withLocale(locale, getWeekdays) as string[]).indexOf(day);\n  return idx >= 0 ? idx : 0;\n}\n\nexport function startOfWeek(day: Date, startOfWeek: number): Date {\n  while (isoWeekday(day) % 7 !== startOfWeek) {\n    day = add(day, -1, 'day');\n  }\n  return day;\n}\n\nexport function endOfWeek(day: Date, startOfWeek: number): Date {\n  const eow = (startOfWeek + 6) % 7;\n  while (isoWeekday(day) % 7 !== eow) {\n    day = add(day, 1, 'day');\n  }\n  return day;\n}\n"],"names":["moment","macroCondition","dependencySatisfies","importSync","default","Error","add","formatDate","startOf","endOf","weekday","isoWeekday","getWeekdaysShort","getWeekdaysMin","getWeekdays","isAfter","isBefore","isSame","isBetween","diff","normalizeDate","normalizeRangeActionValue","normalizeMultipleActionValue","normalizeCalendarDay","withLocale","normalizeCalendarValue","normalizeDuration","getDefaultLocale","localeStartOfWeek","startOfWeek","endOfWeek","date","quantity","unit","toDate","format","locale","weekdaysShort","weekdaysMin","weekdays","date1","date2","start","end","inclusivity","dateOrMoment","Date","isMoment","val","map","e","day","number","fn","returnValue","previousLocale","value","undefined","isDuration","asMilliseconds","matches","match","units","trim","duration","parseInt","now","idx","indexOf","eow"],"mappings":"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"}